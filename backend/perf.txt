def create_parent_columns_recursive(df):
    changed = True
    
    while changed:
        changed = False
        cols_with_sep = [col for col in df.columns if '_' in col]
        
        # Get all possible parent prefixes at all levels
        parents = set()
        for col in cols_with_sep:
            parts = col.split('_')
            for i in range(1, len(parts)):
                parents.add('_'.join(parts[:i]))
        
        # Create missing parent columns
        for parent in parents:
            if parent not in df.columns:
                # Get child columns
                child_cols = [col for col in df.columns 
                             if col.startswith(f'{parent}_') or col == parent]
                if child_cols:
                    # True if any child has a value (not null) OR any child is explicitly True
                    df[parent] = df[child_cols].apply(
                        lambda row: row.notna().any() or (row == True).any(), axis=1
                    )
                    changed = True
            else:
                # Update existing parent column to include new children
                child_cols = [col for col in df.columns 
                             if col != parent and col.startswith(f'{parent}_')]
                if child_cols:
                    # Combine existing parent value with children check
                    all_cols = [parent] + child_cols
                    df[parent] = df[all_cols].apply(
                        lambda row: row.notna().any() or (row == True).any(), axis=1
                    )
    
    return df
